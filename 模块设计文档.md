# 具体模块设计文档

本设计文档详细说明各核心模块的职责、主要功能、关键流程及与其他模块的关系，便于后续开发实现。

---

## 1. 证书管理模块
### 1.1 主要职责
- CA根证书生成、保存、下载
- 域名证书申请、颁发、保存、下载、删除
- 证书文件统一管理

### 1.2 关键流程
- 支持CA根证书一键生成，自动存储
  - 检查根目录下是否存在`certs`目录，不存在则自动创建
  - 生成4096位RSA私钥，保存为`certs/SSLinker.key`，不加密
  - 生成自签名CA证书，保存为`certs/SSLinker.crt`
    - 证书有效期20年（7300天）
    - 主题信息仅填写CN=SSLinker CA，其余字段留空或默认
  - 操作完成后返回证书和私钥的下载链接或文件路径
- 用户提交域名/IP → 调用openssl生成密钥、证书签名请求（CSR）、签发证书 → 保存证书和私钥 → 返回下载链接

### 1.3 主要函数/接口
- generate_ca_cert()
  - 功能：一键生成CA根证书和私钥
  - 输入参数：无（全部自动化，参数固定）
  - 输出：生成结果（成功/失败）、证书和私钥路径/下载链接、错误信息
- generate_domain_cert(domain, ip)
- list_certs()
- download_cert(domain, type)
- delete_cert(domain)

### 1.4 依赖
- openssl命令行工具
- 文件系统

---

## 2. nginx配置管理模块
### 2.1 主要职责
- 根据证书与源地址自动生成nginx配置
- 配置文件管理（生成、删除、列表）
- nginx服务重载

### 2.2 关键流程
- 用户选择证书、输入源地址 → 渲染nginx配置模板 → 写入配置目录 → 执行nginx reload

### 2.3 主要函数/接口
- generate_nginx_config(domain, proxy_pass)
- list_nginx_configs()
- delete_nginx_config(domain)
- reload_nginx()

### 2.4 依赖
- Jinja2模板引擎
- nginx命令行工具
- 文件系统

---

## 3. 系统与状态模块
### 3.1 主要职责
- 展示系统整体状态（证书数、nginx配置数、nginx运行状态）
- 提供操作日志查询
- 错误与异常统一处理

### 3.2 主要函数/接口
- get_status()
- get_logs()
- log_action(action, detail)

---

## 4. 前端模块
### 4.1 主要职责
- 提供现代、美观、易用的UI界面
- 实现证书申请、管理、nginx配置、状态展示等交互流程
- 与后端API对接

### 4.2 主要页面/组件
- 证书管理页（申请、列表、下载、删除）
- nginx配置页（生成、列表、删除、重载）
- 系统状态页（状态、日志展示）
- 公共组件（表单、弹窗、通知、导航等）

### 4.3 依赖
- React、Vite、Tailwind CSS
- axios（请求后端API）

---

## 5. Docker与部署模块
### 5.1 主要职责
- 容器化后端服务与nginx
- 配置证书、nginx配置文件挂载
- 一键部署与升级

### 5.2 主要文件
- Dockerfile（后端、nginx）
- docker-compose.yml

---

# API设计文档

## 1. 生成CA根证书

- 接口路径：`POST /api/ca/generate`
- 请求参数：无（全部自动化，参数固定）
- 处理流程：
  1. 检查并创建`certs`目录
  2. 生成4096位RSA私钥，文件名`SSLinker.key`，不加密
  3. 生成自签名证书，文件名`SSLinker.crt`，有效期20年，主题仅CN
  4. 返回操作结果
- 响应示例：
```json
{
  "success": true,
  "cert_path": "/certs/SSLinker.crt",
  "key_path": "/certs/SSLinker.key",
  "message": "CA根证书生成成功"
}
```
- 失败示例：
```json
{
  "success": false,
  "message": "生成失败，原因：xxx"
}
```
- 安全性：仅管理员或有权限用户可调用

如需某一模块详细时序图、类图或伪代码，可随时补充。
